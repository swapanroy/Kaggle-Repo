{"cells":[{"source":"<a href=\"https://www.kaggle.com/code/swapanroy/predicting-accidents-using-randomforest-regressor?scriptVersionId=267169739\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown"},{"cell_type":"code","execution_count":1,"id":"b4e765a8","metadata":{"execution":{"iopub.execute_input":"2025-10-11T02:53:21.01466Z","iopub.status.busy":"2025-10-11T02:53:21.012934Z","iopub.status.idle":"2025-10-11T02:53:25.675299Z","shell.execute_reply":"2025-10-11T02:53:25.673945Z"},"papermill":{"duration":4.670274,"end_time":"2025-10-11T02:53:25.67716","exception":false,"start_time":"2025-10-11T02:53:21.006886","status":"completed"},"tags":[]},"outputs":[],"source":["import numpy as np\n","import pandas as pd\n","from sklearn.ensemble import RandomForestRegressor\n","import matplotlib.pyplot as plt"]},{"cell_type":"markdown","id":"cdc3018b","metadata":{"papermill":{"duration":0.002882,"end_time":"2025-10-11T02:53:25.683678","exception":false,"start_time":"2025-10-11T02:53:25.680796","status":"completed"},"tags":[]},"source":["## 1. Load Data"]},{"cell_type":"code","execution_count":2,"id":"11447421","metadata":{"execution":{"iopub.execute_input":"2025-10-11T02:53:25.691444Z","iopub.status.busy":"2025-10-11T02:53:25.690952Z","iopub.status.idle":"2025-10-11T02:53:27.120683Z","shell.execute_reply":"2025-10-11T02:53:27.119349Z"},"papermill":{"duration":1.436198,"end_time":"2025-10-11T02:53:27.123007","exception":false,"start_time":"2025-10-11T02:53:25.686809","status":"completed"},"tags":[]},"outputs":[],"source":["train_df = pd.read_csv(\"/kaggle/input/playground-series-s5e10/train.csv\")\n","test_df = pd.read_csv(\"/kaggle/input/playground-series-s5e10/test.csv\")"]},{"cell_type":"code","execution_count":3,"id":"4ccb3c23","metadata":{"execution":{"iopub.execute_input":"2025-10-11T02:53:27.130945Z","iopub.status.busy":"2025-10-11T02:53:27.130625Z","iopub.status.idle":"2025-10-11T02:53:27.277137Z","shell.execute_reply":"2025-10-11T02:53:27.275629Z"},"papermill":{"duration":0.15274,"end_time":"2025-10-11T02:53:27.279184","exception":false,"start_time":"2025-10-11T02:53:27.126444","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["<class 'pandas.core.frame.DataFrame'>\n","RangeIndex: 517754 entries, 0 to 517753\n","Data columns (total 14 columns):\n"," #   Column                  Non-Null Count   Dtype  \n","---  ------                  --------------   -----  \n"," 0   id                      517754 non-null  int64  \n"," 1   road_type               517754 non-null  object \n"," 2   num_lanes               517754 non-null  int64  \n"," 3   curvature               517754 non-null  float64\n"," 4   speed_limit             517754 non-null  int64  \n"," 5   lighting                517754 non-null  object \n"," 6   weather                 517754 non-null  object \n"," 7   road_signs_present      517754 non-null  bool   \n"," 8   public_road             517754 non-null  bool   \n"," 9   time_of_day             517754 non-null  object \n"," 10  holiday                 517754 non-null  bool   \n"," 11  school_season           517754 non-null  bool   \n"," 12  num_reported_accidents  517754 non-null  int64  \n"," 13  accident_risk           517754 non-null  float64\n","dtypes: bool(4), float64(2), int64(4), object(4)\n","memory usage: 41.5+ MB\n"]}],"source":["train_df.info()"]},{"cell_type":"code","execution_count":4,"id":"6db59335","metadata":{"execution":{"iopub.execute_input":"2025-10-11T02:53:27.287443Z","iopub.status.busy":"2025-10-11T02:53:27.287011Z","iopub.status.idle":"2025-10-11T02:53:27.330095Z","shell.execute_reply":"2025-10-11T02:53:27.328572Z"},"papermill":{"duration":0.049622,"end_time":"2025-10-11T02:53:27.332373","exception":false,"start_time":"2025-10-11T02:53:27.282751","status":"completed"},"tags":[]},"outputs":[{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>id</th>\n","      <th>road_type</th>\n","      <th>num_lanes</th>\n","      <th>curvature</th>\n","      <th>speed_limit</th>\n","      <th>lighting</th>\n","      <th>weather</th>\n","      <th>road_signs_present</th>\n","      <th>public_road</th>\n","      <th>time_of_day</th>\n","      <th>holiday</th>\n","      <th>school_season</th>\n","      <th>num_reported_accidents</th>\n","      <th>accident_risk</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>0</td>\n","      <td>urban</td>\n","      <td>2</td>\n","      <td>0.06</td>\n","      <td>35</td>\n","      <td>daylight</td>\n","      <td>rainy</td>\n","      <td>False</td>\n","      <td>True</td>\n","      <td>afternoon</td>\n","      <td>False</td>\n","      <td>True</td>\n","      <td>1</td>\n","      <td>0.13</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>1</td>\n","      <td>urban</td>\n","      <td>4</td>\n","      <td>0.99</td>\n","      <td>35</td>\n","      <td>daylight</td>\n","      <td>clear</td>\n","      <td>True</td>\n","      <td>False</td>\n","      <td>evening</td>\n","      <td>True</td>\n","      <td>True</td>\n","      <td>0</td>\n","      <td>0.35</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>2</td>\n","      <td>rural</td>\n","      <td>4</td>\n","      <td>0.63</td>\n","      <td>70</td>\n","      <td>dim</td>\n","      <td>clear</td>\n","      <td>False</td>\n","      <td>True</td>\n","      <td>morning</td>\n","      <td>True</td>\n","      <td>False</td>\n","      <td>2</td>\n","      <td>0.30</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>3</td>\n","      <td>highway</td>\n","      <td>4</td>\n","      <td>0.07</td>\n","      <td>35</td>\n","      <td>dim</td>\n","      <td>rainy</td>\n","      <td>True</td>\n","      <td>True</td>\n","      <td>morning</td>\n","      <td>False</td>\n","      <td>False</td>\n","      <td>1</td>\n","      <td>0.21</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>4</td>\n","      <td>rural</td>\n","      <td>1</td>\n","      <td>0.58</td>\n","      <td>60</td>\n","      <td>daylight</td>\n","      <td>foggy</td>\n","      <td>False</td>\n","      <td>False</td>\n","      <td>evening</td>\n","      <td>True</td>\n","      <td>False</td>\n","      <td>1</td>\n","      <td>0.56</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>517749</th>\n","      <td>517749</td>\n","      <td>highway</td>\n","      <td>4</td>\n","      <td>0.10</td>\n","      <td>70</td>\n","      <td>daylight</td>\n","      <td>foggy</td>\n","      <td>True</td>\n","      <td>True</td>\n","      <td>afternoon</td>\n","      <td>False</td>\n","      <td>False</td>\n","      <td>2</td>\n","      <td>0.32</td>\n","    </tr>\n","    <tr>\n","      <th>517750</th>\n","      <td>517750</td>\n","      <td>rural</td>\n","      <td>4</td>\n","      <td>0.47</td>\n","      <td>35</td>\n","      <td>daylight</td>\n","      <td>rainy</td>\n","      <td>True</td>\n","      <td>True</td>\n","      <td>morning</td>\n","      <td>False</td>\n","      <td>False</td>\n","      <td>1</td>\n","      <td>0.26</td>\n","    </tr>\n","    <tr>\n","      <th>517751</th>\n","      <td>517751</td>\n","      <td>urban</td>\n","      <td>4</td>\n","      <td>0.62</td>\n","      <td>25</td>\n","      <td>daylight</td>\n","      <td>foggy</td>\n","      <td>False</td>\n","      <td>False</td>\n","      <td>afternoon</td>\n","      <td>False</td>\n","      <td>True</td>\n","      <td>0</td>\n","      <td>0.19</td>\n","    </tr>\n","    <tr>\n","      <th>517752</th>\n","      <td>517752</td>\n","      <td>highway</td>\n","      <td>3</td>\n","      <td>0.63</td>\n","      <td>25</td>\n","      <td>night</td>\n","      <td>clear</td>\n","      <td>True</td>\n","      <td>False</td>\n","      <td>afternoon</td>\n","      <td>True</td>\n","      <td>True</td>\n","      <td>3</td>\n","      <td>0.51</td>\n","    </tr>\n","    <tr>\n","      <th>517753</th>\n","      <td>517753</td>\n","      <td>highway</td>\n","      <td>2</td>\n","      <td>0.31</td>\n","      <td>45</td>\n","      <td>dim</td>\n","      <td>rainy</td>\n","      <td>False</td>\n","      <td>True</td>\n","      <td>afternoon</td>\n","      <td>True</td>\n","      <td>True</td>\n","      <td>2</td>\n","      <td>0.22</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>517754 rows Ã— 14 columns</p>\n","</div>"],"text/plain":["            id road_type  num_lanes  curvature  speed_limit  lighting weather  \\\n","0            0     urban          2       0.06           35  daylight   rainy   \n","1            1     urban          4       0.99           35  daylight   clear   \n","2            2     rural          4       0.63           70       dim   clear   \n","3            3   highway          4       0.07           35       dim   rainy   \n","4            4     rural          1       0.58           60  daylight   foggy   \n","...        ...       ...        ...        ...          ...       ...     ...   \n","517749  517749   highway          4       0.10           70  daylight   foggy   \n","517750  517750     rural          4       0.47           35  daylight   rainy   \n","517751  517751     urban          4       0.62           25  daylight   foggy   \n","517752  517752   highway          3       0.63           25     night   clear   \n","517753  517753   highway          2       0.31           45       dim   rainy   \n","\n","        road_signs_present  public_road time_of_day  holiday  school_season  \\\n","0                    False         True   afternoon    False           True   \n","1                     True        False     evening     True           True   \n","2                    False         True     morning     True          False   \n","3                     True         True     morning    False          False   \n","4                    False        False     evening     True          False   \n","...                    ...          ...         ...      ...            ...   \n","517749                True         True   afternoon    False          False   \n","517750                True         True     morning    False          False   \n","517751               False        False   afternoon    False           True   \n","517752                True        False   afternoon     True           True   \n","517753               False         True   afternoon     True           True   \n","\n","        num_reported_accidents  accident_risk  \n","0                            1           0.13  \n","1                            0           0.35  \n","2                            2           0.30  \n","3                            1           0.21  \n","4                            1           0.56  \n","...                        ...            ...  \n","517749                       2           0.32  \n","517750                       1           0.26  \n","517751                       0           0.19  \n","517752                       3           0.51  \n","517753                       2           0.22  \n","\n","[517754 rows x 14 columns]"]},"execution_count":4,"metadata":{},"output_type":"execute_result"}],"source":["train_df"]},{"cell_type":"code","execution_count":5,"id":"c1e8e7e5","metadata":{"execution":{"iopub.execute_input":"2025-10-11T02:53:27.343354Z","iopub.status.busy":"2025-10-11T02:53:27.343004Z","iopub.status.idle":"2025-10-11T02:53:27.394148Z","shell.execute_reply":"2025-10-11T02:53:27.392831Z"},"papermill":{"duration":0.058992,"end_time":"2025-10-11T02:53:27.396042","exception":false,"start_time":"2025-10-11T02:53:27.33705","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["<class 'pandas.core.frame.DataFrame'>\n","RangeIndex: 172585 entries, 0 to 172584\n","Data columns (total 13 columns):\n"," #   Column                  Non-Null Count   Dtype  \n","---  ------                  --------------   -----  \n"," 0   id                      172585 non-null  int64  \n"," 1   road_type               172585 non-null  object \n"," 2   num_lanes               172585 non-null  int64  \n"," 3   curvature               172585 non-null  float64\n"," 4   speed_limit             172585 non-null  int64  \n"," 5   lighting                172585 non-null  object \n"," 6   weather                 172585 non-null  object \n"," 7   road_signs_present      172585 non-null  bool   \n"," 8   public_road             172585 non-null  bool   \n"," 9   time_of_day             172585 non-null  object \n"," 10  holiday                 172585 non-null  bool   \n"," 11  school_season           172585 non-null  bool   \n"," 12  num_reported_accidents  172585 non-null  int64  \n","dtypes: bool(4), float64(1), int64(4), object(4)\n","memory usage: 12.5+ MB\n"]}],"source":["test_df.info()"]},{"cell_type":"markdown","id":"020998e8","metadata":{"papermill":{"duration":0.003722,"end_time":"2025-10-11T02:53:27.40406","exception":false,"start_time":"2025-10-11T02:53:27.400338","status":"completed"},"tags":[]},"source":["\n","## 2. Separate Target and IDs"]},{"cell_type":"code","execution_count":6,"id":"53a4572f","metadata":{"execution":{"iopub.execute_input":"2025-10-11T02:53:27.413454Z","iopub.status.busy":"2025-10-11T02:53:27.4131Z","iopub.status.idle":"2025-10-11T02:53:27.460379Z","shell.execute_reply":"2025-10-11T02:53:27.459039Z"},"papermill":{"duration":0.054199,"end_time":"2025-10-11T02:53:27.462242","exception":false,"start_time":"2025-10-11T02:53:27.408043","status":"completed"},"tags":[]},"outputs":[],"source":["target = train_df['accident_risk']\n","test_ids = test_df['id']\n","\n","# Drop 'id' and 'accident_risk' from the training set\n","train_df = train_df.drop(columns=['id', 'accident_risk'])\n","test_df = test_df.drop(columns=['id'])"]},{"cell_type":"markdown","id":"b9def8ce","metadata":{"papermill":{"duration":0.004255,"end_time":"2025-10-11T02:53:27.470935","exception":false,"start_time":"2025-10-11T02:53:27.46668","status":"completed"},"tags":[]},"source":["\n","## 3. Feature Engineering "]},{"cell_type":"code","execution_count":7,"id":"68dd0f3b","metadata":{"execution":{"iopub.execute_input":"2025-10-11T02:53:27.484558Z","iopub.status.busy":"2025-10-11T02:53:27.483817Z","iopub.status.idle":"2025-10-11T02:53:28.055383Z","shell.execute_reply":"2025-10-11T02:53:28.054257Z"},"papermill":{"duration":0.580545,"end_time":"2025-10-11T02:53:28.057168","exception":false,"start_time":"2025-10-11T02:53:27.476623","status":"completed"},"tags":[]},"outputs":[],"source":["# Concatenate train and test data for consistent encoding\n","combined_df = pd.concat([train_df, test_df], ignore_index=True)\n","\n","# Identify boolean and object columns\n","bool_cols = combined_df.select_dtypes(include=['bool']).columns\n","object_cols = combined_df.select_dtypes(include=['object']).columns\n","\n","# Convert boolean columns to integer 0/1\n","for col in bool_cols:\n","    combined_df[col] = combined_df[col].astype(int)\n","\n","# One-Hot Encoding for object type columns\n","# This handles 'road_type', 'lighting', 'weather', and 'time_of_day'\n","combined_df = pd.get_dummies(combined_df, columns=object_cols, drop_first=True)\n","\n","# Separate the combined data back into training and testing sets\n","X_train = combined_df.iloc[:len(train_df)]\n","X_test = combined_df.iloc[len(train_df):]\n","y_train = target"]},{"cell_type":"markdown","id":"0ecf78e4","metadata":{"papermill":{"duration":0.004582,"end_time":"2025-10-11T02:53:28.065956","exception":false,"start_time":"2025-10-11T02:53:28.061374","status":"completed"},"tags":[]},"source":["## 4. Model Training (RandomForestRegressor)"]},{"cell_type":"code","execution_count":8,"id":"7e525431","metadata":{"execution":{"iopub.execute_input":"2025-10-11T02:53:28.075725Z","iopub.status.busy":"2025-10-11T02:53:28.075355Z","iopub.status.idle":"2025-10-11T02:53:53.064971Z","shell.execute_reply":"2025-10-11T02:53:53.063693Z"},"papermill":{"duration":24.996414,"end_time":"2025-10-11T02:53:53.066789","exception":false,"start_time":"2025-10-11T02:53:28.070375","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["Starting model training (RandomForestRegressor)...\n","Model training complete.\n"]}],"source":["# Using a modest set of hyper-parameters for efficiency on a large dataset\n","rfr = RandomForestRegressor(\n","    n_estimators=150,      # Number of trees\n","    max_depth=10,          # Limiting depth to speed up training and reduce overfitting\n","    min_samples_split=20,  # Minimum samples required to split an internal node\n","    random_state=42,       # For reproducibility\n","    n_jobs=-1,              # Use all avail    \n","    min_samples_leaf=8,     # Additional regularization\n","    max_features='sqrt'     # Feature subsampling\n","    \n",")\n","\n","print(\"Starting model training (RandomForestRegressor)...\")\n","rfr.fit(X_train, y_train)\n","print(\"Model training complete.\")"]},{"cell_type":"markdown","id":"1bab6bba","metadata":{"papermill":{"duration":0.003584,"end_time":"2025-10-11T02:53:53.074324","exception":false,"start_time":"2025-10-11T02:53:53.07074","status":"completed"},"tags":[]},"source":["## 5. Prediction and Submission File Generation"]},{"cell_type":"code","execution_count":9,"id":"02ee8a7c","metadata":{"_cell_guid":"b1076dfc-b9ad-4769-8c92-a6c4dae69d19","_uuid":"8f2839f25d086af736a60e9eeb907d3b93b6e0e5","execution":{"iopub.execute_input":"2025-10-11T02:53:53.08305Z","iopub.status.busy":"2025-10-11T02:53:53.08274Z","iopub.status.idle":"2025-10-11T02:53:54.693868Z","shell.execute_reply":"2025-10-11T02:53:54.692563Z"},"papermill":{"duration":1.617802,"end_time":"2025-10-11T02:53:54.695752","exception":false,"start_time":"2025-10-11T02:53:53.07795","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["\n","Submission file 'submission.csv' created.\n","       id  accident_risk\n","0  517754       0.304472\n","1  517755       0.145614\n","2  517756       0.234389\n","3  517757       0.314505\n","4  517758       0.434081\n"]}],"source":["# Generate predictions on the test set\n","predictions = rfr.predict(X_test)\n","\n","# Ensure predictions are between 0 and 1\n","predictions = np.clip(predictions, 0, 1)\n","\n","# Create the submission \n","submission_df = pd.DataFrame({\n","    'id': test_ids,\n","    'accident_risk': predictions\n","})\n","\n","# Save the submission file\n","submission_df.to_csv('submission.csv', index=False)\n","\n","print(\"\\nSubmission file 'submission.csv' created.\")\n","print(submission_df.head())"]}],"metadata":{"kaggle":{"accelerator":"none","dataSources":[{"databundleVersionId":13760552,"sourceId":91721,"sourceType":"competition"}],"dockerImageVersionId":31153,"isGpuEnabled":false,"isInternetEnabled":true,"language":"python","sourceType":"notebook"},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.11.13"},"papermill":{"default_parameters":{},"duration":40.209795,"end_time":"2025-10-11T02:53:55.420975","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2025-10-11T02:53:15.21118","version":"2.6.0"}},"nbformat":4,"nbformat_minor":5}